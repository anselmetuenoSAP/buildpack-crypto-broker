#!/usr/bin/env bash
# bin/detect - Determines if the buildpack should be applied

set -e

BUILD_DIR=$1

echo "====== DETECT SCRIPT RUNNING v1.0.0 ======" >&2
echo "BP_NODE_APP_DIR value: '${BP_NODE_APP_DIR}'" >&2

# Node.js app directory must be specified via BP_NODE_APP_DIR
if [ -z "${BP_NODE_APP_DIR}" ]; then
    echo "ERROR: BP_NODE_APP_DIR environment variable is required but not set" >&2
    exit 1
fi

NODE_APP_DIR="${BP_NODE_APP_DIR}"

# Check if this is a crypto-broker application
if [ -d "$BUILD_DIR/crypto-broker-server" ] && [ -d "$BUILD_DIR/$NODE_APP_DIR" ]; then
    echo "Crypto Broker Application (Node app: $NODE_APP_DIR)"
    exit 0
fi

exit 1
